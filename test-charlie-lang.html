<!doctype html>
<html>
<head>

    <script type="text/javascript" src="parser.js"></script>
    
</head>
<body>
<div id="test_script" style="display:none;">
    testVar = "Adhir Ramjiawan"
    someOtherMessage = testVar

    log "Hello world"
    log testVar
    alert someOtherMessage
</div>
<script type="text/javascript">
    var script = document.getElementById("test_script").innerHTML;
    var results = CharlieLangParser.parse(script);

    executeInstructions(results);

    function executeInstructions(instructions) {
        var variables = [];

        instructions.map(function(e) {

            if (e.tokInstr && e.tokInstr === 'log') {
                var message = null;

                if (e.type && e.type === 'stringInstruction') {
                    message = e.tokParam;
                } else if (e.type && e.type === 'variableInstruction') {
                    var variable = findVariable(e.tokParam);

                    if (variable) {
                        message = variable.value;
                    } else {
                        // throw runtime error
                        console.error("unknown variable: " + e.tokParam);
                        return;
                    }
                }

                consoleFunc(message);
            } else if (e.tokInstr && e.tokInstr === 'alert') {
                var message = null;

                if (e.type && e.type === 'stringInstruction') {
                    message = e.tokParam;
                } else if (e.type && e.type === 'variableInstruction') {
                    var variable = findVariable(e.tokParam);

                    if (variable) {
                        message = variable.value;
                    } else {
                        // throw runtime error
                        console.error("unknown variable: " + e.tokParam);
                        return;
                    }
                }

                alertFunc(message);
            } else if (e.type && e.type === 'variableLiteralAssignmentInstruction') {
                var newVar = createVariable(e.tokLHS, "literal", e.tokRHS);
                variables.push(newVar);
            } else if (e.type && e.type === 'variableVariableAssignmentInstruction') {
                var newVar = null;
                var existingVar = findVariable(e.tokRHS);

                if (!existingVar) {
                    console.error("unknown variable: " + e.tokRHS);
                    return;
                }

                newVar = createVariable(e.tokLHS, "literal", existingVar.value);
                variables.push(newVar);
            }

            
        });

        function createVariable(_name, _type, _value) {
            return {
                name: _name,
                type: _type,
                value: _value
            };
        }

        function findVariable(varName) {
            for (var i = 0; i < variables.length; i++) {
                if (varName === variables[i].name) {
                    return variables[i];
                }
            }

            return null;
        }
    }

    function consoleFunc(message) {
        console.log(message);
    }

    function alertFunc(message) {
        alert(message);
    }
</script>
</body>
</html>